{"version":3,"sources":["webpack:///webpack/bootstrap 75e78adc9dfed9ae0bf0","webpack:///./src/server.js","webpack:///external \"hapi\"","webpack:///external \"hapi-auth-jwt\"","webpack:///./src/routes/vote/vote.get.js","webpack:///./src/shared/route.js","webpack:///./src/routes/vote/vote.service.js","webpack:///./src/shared/redis-db.js","webpack:///external \"redis\"","webpack:///external \"q\"","webpack:///external \"url\"","webpack:///./src/routes/vote/vote.post.js","webpack:///./src/routes/auth/auth.post.js","webpack:///./src/routes/auth/auth.service.js","webpack:///external \"qs\"","webpack:///external \"jwt-simple\"","webpack:///external \"moment\"","webpack:///external \"request\"","webpack:///./src/config.js"],"names":[],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 75e78adc9dfed9ae0bf0\n **/","import Hapi from 'hapi';\nimport hapiAuthJwt from 'hapi-auth-jwt';\nimport VoteGetRoute from './routes/vote/vote.get.js';\nimport VotePostRoute from './routes/vote/vote.post.js';\nimport AuthPostRoute from './routes/auth/auth.post';\nimport AuthService from './routes/auth/auth.service';\n\nconst authService = new AuthService();\nconst server = new Hapi.Server();\nserver.connection({\n    host: process.env.IP || '0.0.0.0',\n    port: process.env.PORT || 3000\n});\n\nserver.register(hapiAuthJwt, () => {\n    server.auth.strategy('token', 'jwt', authService.authStrategy);\n\n    server.route({\n        method: 'GET',\n        path: '/api/test',\n        handler(request, reply) {\n            reply({ test: 'test' });\n        }\n    });\n\n    server.route(new VoteGetRoute());\n    server.route(new VotePostRoute());\n    server.route(new AuthPostRoute());\n});\n\nserver.start((err) => {\n    if (err) { throw err; }\n    console.log(`Server running at: ${server.info.uri}`);\n});\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server.js\n **/","module.exports = require(\"hapi\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"hapi\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"hapi-auth-jwt\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"hapi-auth-jwt\"\n ** module id = 2\n ** module chunks = 0\n **/","import Route from '../../shared/route';\nimport VoteService from './vote.service';\n\nclass VoteGetRoute extends Route {\n\n    constructor(method = 'GET', path = '/api/vote') {\n        super({ method, path });\n        this.config = {\n            cors: true,\n            auth: 'token'\n        };\n    }\n\n    handler(request, reply) {\n        const voteService = new VoteService();\n        const credentials = request.auth.credentials;\n        voteService.getVote(credentials).then((vote) => {\n            reply({ vote });\n        });\n    }\n}\n\nexport default VoteGetRoute;\n\n\n/** WEBPACK FOOTER **\n ** ./src/routes/vote/vote.get.js\n **/","class Route {\n\n    constructor(params = {}) {\n        this.method = params.method;\n        this.path = params.path;\n    }\n\n    handler(request, reply) {\n        reply('Hello!');\n    }\n}\n\nexport default Route;\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/route.js\n **/","import Redis from '../../shared/redis-db';\n\nclass VoteService extends Redis {\n\n    saveVote(user, vote) {\n        return this.saveHash(voteHashKey(user.id), vote).then(() => vote, (err) => err);\n    }\n\n    getVote(user) {\n        return this.getHash(voteHashKey(user.id)).then((vote) => vote);\n    }\n}\n\nfunction voteHashKey(id) {\n    return `vote:${id}`;\n}\n\nexport default VoteService;\n\n\n/** WEBPACK FOOTER **\n ** ./src/routes/vote/vote.service.js\n **/","import redis from 'redis';\nimport q from 'q';\nimport url from 'url';\n\nclass Redis {\n\n    constructor(params = {}) {\n        if (process.env.REDISTOGO_URL) {\n            const rtg = url.parse(process.env.REDISTOGO_URL);\n            this.client = redis.createClient(rtg.port, rtg.hostname);\n            this.client.auth(rtg.auth.split(':')[1]);\n        } else {\n            this.client = params.client || redis.createClient();\n        }\n        this.client.on('error', (err) => console.log(`Error ${err}`));\n    }\n\n    saveHash(key, hash) {\n        const deferred = q.defer();\n\n        this.client.hmset(key, hash, (err, result) => {\n            if (err) {\n                deferred.reject(`Error saving hash to Redis: ${err}`);\n            }\n\n            deferred.resolve(result);\n        });\n\n        return deferred.promise;\n    }\n\n    getHash(key) {\n        const deferred = q.defer();\n\n        this.client.hgetall(key, (err, result) => {\n            if (err) {\n                deferred.reject(`Error retrieving hash ${key} from Redis: ${err}`);\n            }\n\n            deferred.resolve(result);\n        });\n\n        return deferred.promise;\n    }\n\n}\n\nexport default Redis;\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/redis-db.js\n **/","module.exports = require(\"redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redis\"\n ** module id = 7\n ** module chunks = 0\n **/","module.exports = require(\"q\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"q\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"url\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"url\"\n ** module id = 9\n ** module chunks = 0\n **/","import Route from '../../shared/route';\nimport VoteService from './vote.service';\n\nclass VotePostRoute extends Route {\n\n    constructor(method = 'POST', path = '/api/vote') {\n        super({ method, path });\n        this.config = {\n            cors: true,\n            auth: 'token'\n        };\n    }\n\n    handler(request, reply) {\n        const voteService = new VoteService();\n        const credentials = request.auth.credentials;\n        const selectedVote = Object.assign({}, JSON.parse(request.payload).vote, {\n            date: new Date()\n        });\n        voteService.saveVote(credentials, selectedVote).then((vote) => reply({ vote }));\n    }\n}\n\nexport default VotePostRoute;\n\n\n/** WEBPACK FOOTER **\n ** ./src/routes/vote/vote.post.js\n **/","import Route from '../../shared/route';\nimport AuthService from './auth.service';\n\nclass AuthPostRoute extends Route {\n\n    constructor(method = 'POST', path = '/auth/twitter') {\n        super({ method, path });\n        this.config = {\n            cors: true\n        };\n    }\n\n    handler(request, reply) {\n        const authService = new AuthService(request.payload);\n        authService.authenticate().then((data) => {\n            reply(data);\n        });\n    }\n}\n\nexport default AuthPostRoute;\n\n\n/** WEBPACK FOOTER **\n ** ./src/routes/auth/auth.post.js\n **/","import q from 'q';\nimport qs from 'qs';\nimport jwt from 'jwt-simple';\nimport moment from 'moment';\nimport request from 'request';\nimport { CONFIG } from '../../config';\nimport Redis from '../../shared/redis-db';\n\nclass AuthService extends Redis {\n\n    constructor(payload = null) {\n        super();\n        this.payload = JSON.parse(payload);\n\n        this.authStrategy = {\n            key: CONFIG.TOKEN_SECRET,\n            validateFunc: this.validateUser.bind(this),\n            verifyOptions: { algorithms: ['HS256'] }\n        };\n    }\n\n    authenticate() {\n        if (!this.payload.oauth_token || !this.payload.oauth_verifier) {\n            return obtainRequestToken(this.payload);\n        }\n\n        return obtainAccessToken(this.payload)\n            .then((accessToken) => obtainProfileInfo(accessToken))\n            .then((user) => createUserAccount.call(this, user))\n            .then((user) => ({\n                token: createJWT(user),\n                data: user\n            }));\n    }\n\n    validateUser(req, decoded, callback) {\n        this.getHash(userHashKey(decoded.sub))\n            .then((session) => {\n                if (!session) {\n                    return callback(null, false);\n                }\n                return callback(null, true, session);\n            }, () => callback(null, false));\n    }\n}\n\nfunction obtainRequestToken(payload) {\n    const deferred = q.defer();\n    const requestTokenOauth = {\n        consumer_key: CONFIG.TWITTER_KEY,\n        consumer_secret: CONFIG.TWITTER_SECRET,\n        callback: payload.redirectUri\n    };\n\n    request.post({ url: CONFIG.REQUEST_TOKEN_URL, oauth: requestTokenOauth }, (err, response, oauthToken) => {\n        if (err) {\n            deferred.reject(err);\n        }\n        // Step 2. Send OAuth token back to open the authorization screen.\n        const parsedOauthToken = qs.parse(oauthToken);\n        deferred.resolve(parsedOauthToken);\n    });\n\n    return deferred.promise;\n}\n\nfunction obtainAccessToken(payload) {\n    const deferred = q.defer();\n    const accessTokenOauth = {\n        consumer_key: CONFIG.TWITTER_KEY,\n        consumer_secret: CONFIG.TWITTER_SECRET,\n        token: payload.oauth_token,\n        verifier: payload.oauth_verifier\n    };\n\n    request.post({ url: CONFIG.ACCESS_TOKEN_URL, oauth: accessTokenOauth }, (err, response, accessToken) => {\n        if (err) {\n            deferred.reject(err);\n        }\n        const parsedAccessToken = qs.parse(accessToken);\n        deferred.resolve(parsedAccessToken);\n    });\n\n    return deferred.promise;\n}\n\nfunction obtainProfileInfo(parsedAccessToken) {\n    const deferred = q.defer();\n    const profileOauth = {\n        consumer_key: CONFIG.TWITTER_KEY,\n        consumer_secret: CONFIG.TWITTER_SECRET,\n        oauth_token: parsedAccessToken.oauth_token\n    };\n\n    // Step 4. Retrieve profile information about the current user.\n    request.get({\n        url: `${CONFIG.PROFILE_URL}${parsedAccessToken.screen_name}`,\n        oauth: profileOauth,\n        json: true\n    }, (err, response, profile) => {\n        if (err) {\n            deferred.reject(err);\n        }\n\n        const user = {\n            id: profile.id,\n            twitterHandle: profile.screen_name,\n            displayName: profile.name,\n            picture: profile.profile_image_url.replace('_normal', '')\n        };\n\n        deferred.resolve(user);\n    });\n\n    return deferred.promise;\n}\n\nfunction createUserAccount(user) {\n    return this.saveHash(userHashKey(user.id), user).then(() => user, (err) => err);\n}\n\nfunction createJWT(user) {\n    const payload = {\n        sub: user.id,\n        iat: moment().unix(),\n        exp: moment().add(14, 'days').unix()\n    };\n\n    return jwt.encode(payload, CONFIG.TOKEN_SECRET);\n}\n\nfunction userHashKey(id) {\n    return `user:${id}`;\n}\n\nexport default AuthService;\n\n\n/** WEBPACK FOOTER **\n ** ./src/routes/auth/auth.service.js\n **/","module.exports = require(\"qs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"qs\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"jwt-simple\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jwt-simple\"\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 15\n ** module chunks = 0\n **/","module.exports = require(\"request\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"request\"\n ** module id = 16\n ** module chunks = 0\n **/","export const CONFIG = {\n    REQUEST_TOKEN_URL: 'https://api.twitter.com/oauth/request_token',\n    ACCESS_TOKEN_URL: 'https://api.twitter.com/oauth/access_token',\n    PROFILE_URL: 'https://api.twitter.com/1.1/users/show.json?screen_name=',\n\n    // App Settings\n    TOKEN_SECRET: process.env.TOKEN_SECRET || 'YOUR_UNIQUE_JWT_TOKEN_SECRET',\n\n    // OAuth 1.0\n    TWITTER_KEY: process.env.TWITTER_KEY || 'VAaXxYKOsNgE1KaFUfsFdVpBn',\n    TWITTER_SECRET: process.env.TWITTER_SECRET || 'vcjDy4ZkEzpmSpIc1iQcRH76GemJGGGPWXoSarRS7JE4JEZrvY'\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/config.js\n **/"],"sourceRoot":""}